import { gql } from 'graphql-request';
import { SnxPriceParams } from '../../src/types';
import { timeSeriesEntityMap } from '../../src/constants';
import { createGQLWhereString } from '../../src/utils';

export const createSnxPriceQuery = ({
	timeSeries,
	autoGeneratedPaginationField,
}: SnxPriceParams): string => {
	const whereString = createGQLWhereString(
		Object.entries({
			id_lt: autoGeneratedPaginationField != null ? 'autoGeneratedPaginationField' : null,
		})
	);
	return gql`
	query snxPrices($autoGeneratedPaginationField: Int, $max: Int, $timeSeries: String) {
		${timeSeriesEntityMap[timeSeries]}(
			first: $max
			where: ${whereString}
			orderBy: id
			orderDirection: desc
		) {
			id
			averagePrice
		}
	}`;
};
