import deployments from './deployments.json';
export const DeploymentAddresses = ({ chainId }) => {
  const etherscanBase = {
    5: 'https://goerli.etherscan.io/address/',
    420: 'https://goerli-optimism.etherscan.io/address/',
  };
  const displayNames = {
    CoreProxy: 'Core System',
    AccountProxy: 'Account Token',
    USDProxy: 'snxUSD Token',
  };
  const modules = {};
  Object.keys(deployments.deploys[chainId].main.def.run).map((key, index) => {
    let name = key.split('_')[0];
    const mods = deployments.deploys[chainId].main.def.run[key].depends
      .map((mod) => mod.split('.')[1])
      .filter((m) => m != 'InitialModuleBundle');
    modules[name] = mods;
  });
  const capitalizeFirstLetter = (string) => string.charAt(0).toUpperCase() + string.slice(1);
  const kebabize = (str) =>
    str.replace(/[A-Z]+(?![a-z])|[A-Z]/g, ($, ofs) => (ofs ? '-' : '') + $.toLowerCase());
  const processed = ['CoreProxy', 'AccountProxy', 'USDProxy'].map((key, index) => {
    const address = require(`./deployments/${chainId}/${key}.json`).address;
    const etherscan = etherscanBase[chainId] + address;
    return {
      name: displayNames[key],
      address,
      etherscan,
      modules: modules[key.toLowerCase().replace('proxy', '')],
    };
  });
  return (
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Address</th>
          <th>Modules</th>
        </tr>
      </thead>
      <tbody>
        {processed.map((contract, index) => {
          return (
            <tr key={index}>
              <td style={{ whiteSpace: 'nowrap' }}>{contract.name}</td>
              <td>
                <a target="_blank" href={contract.etherscan}>
                  {contract.address}
                </a>
              </td>
              <td>
                {contract.modules.map((module, index2) => {
                  return (
                    <small key={index2}>
                      <a href={'./smart-contracts#' + kebabize(module)}>{module}</a>
                      {index2 < contract.modules.length - 1 ? ', ' : ''}
                    </small>
                  );
                })}
              </td>
            </tr>
          );
        })}
      </tbody>
    </table>
  );
};
