{"version":3,"file":"Middleware.js","sources":["../../../../../node_modules/stylis/src/Middleware.js"],"sourcesContent":["import {MS, MOZ, WEBKIT, RULESET, KEYFRAMES, DECLARATION} from './Enum.js'\nimport {match, charat, substr, strlen, sizeof, replace, combine} from './Utility.js'\nimport {copy, tokenize} from './Tokenizer.js'\nimport {serialize} from './Serializer.js'\nimport {prefix} from './Prefixer.js'\n\n/**\n * @param {function[]} collection\n * @return {function}\n */\nexport function middleware (collection) {\n\tvar length = sizeof(collection)\n\n\treturn function (element, index, children, callback) {\n\t\tvar output = ''\n\n\t\tfor (var i = 0; i < length; i++)\n\t\t\toutput += collection[i](element, index, children, callback) || ''\n\n\t\treturn output\n\t}\n}\n\n/**\n * @param {function} callback\n * @return {function}\n */\nexport function rulesheet (callback) {\n\treturn function (element) {\n\t\tif (!element.root)\n\t\t\tif (element = element.return)\n\t\t\t\tcallback(element)\n\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n */\nexport function prefixer (element, index, children, callback) {\n\tif (element.length > -1)\n\t\tif (!element.return)\n\t\t\tswitch (element.type) {\n\t\t\t\tcase DECLARATION: element.return = prefix(element.value, element.length)\n\t\t\t\t\tbreak\n\t\t\t\tcase KEYFRAMES:\n\t\t\t\t\treturn serialize([copy(element, {value: replace(element.value, '@', '@' + WEBKIT)})], callback)\n\t\t\t\tcase RULESET:\n\t\t\t\t\tif (element.length)\n\t\t\t\t\t\treturn combine(element.props, function (value) {\n\t\t\t\t\t\t\tswitch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n\t\t\t\t\t\t\t\t// :read-(only|write)\n\t\t\t\t\t\t\t\tcase ':read-only': case ':read-write':\n\t\t\t\t\t\t\t\t\treturn serialize([copy(element, {props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]})], callback)\n\t\t\t\t\t\t\t\t// :placeholder\n\t\t\t\t\t\t\t\tcase '::placeholder':\n\t\t\t\t\t\t\t\t\treturn serialize([\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]})\n\t\t\t\t\t\t\t\t\t], callback)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn ''\n\t\t\t\t\t\t})\n\t\t\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n */\nexport function namespace (element) {\n\tswitch (element.type) {\n\t\tcase RULESET:\n\t\t\telement.props = element.props.map(function (value) {\n\t\t\t\treturn combine(tokenize(value), function (value, index, children) {\n\t\t\t\t\tswitch (charat(value, 0)) {\n\t\t\t\t\t\t// \\f\n\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\treturn substr(value, 1, strlen(value))\n\t\t\t\t\t\t// \\0 ( + > ~\n\t\t\t\t\t\tcase 0: case 40: case 43: case 62: case 126:\n\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t// :\n\t\t\t\t\t\tcase 58:\n\t\t\t\t\t\t\tif (children[++index] === 'global')\n\t\t\t\t\t\t\t\tchildren[index] = '', children[++index] = '\\f' + substr(children[index], index = 1, -1)\n\t\t\t\t\t\t// \\s\n\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\treturn index === 1 ? '' : value\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tswitch (index) {\n\t\t\t\t\t\t\t\tcase 0: element = value\n\t\t\t\t\t\t\t\t\treturn sizeof(children) > 1 ? '' : value\n\t\t\t\t\t\t\t\tcase index = sizeof(children) - 1: case 2:\n\t\t\t\t\t\t\t\t\treturn index === 2 ? value + element + element : value + element\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t}\n}\n"],"names":["collection","length","sizeof","element","index","children","callback","output","i","return","type","DECLARATION","prefix","value","KEYFRAMES","serialize","copy","replace","WEBKIT","RULESET","combine","props","match","MOZ","MS","root"],"mappings":"gOAUO,SAAqBA,GAC3B,IAAIC,EAASC,EAAMA,OAACF,GAEpB,OAAO,SAAUG,EAASC,EAAOC,EAAUC,GAG1C,IAFA,IAAIC,EAAS,GAEJC,EAAI,EAAGA,EAAIP,EAAQO,IAC3BD,GAAUP,EAAWQ,GAAGL,EAASC,EAAOC,EAAUC,IAAa,GAEhE,OAAOC,CACP,CACF,mBAoBO,SAAmBJ,EAASC,EAAOC,EAAUC,GACnD,GAAIH,EAAQF,QAAU,IAChBE,EAAQM,OACZ,OAAQN,EAAQO,MACf,KAAKC,EAAWA,YAAER,EAAQM,OAASG,EAAAA,OAAOT,EAAQU,MAAOV,EAAQF,QAChE,MACD,KAAKa,EAASA,UACb,OAAOC,EAAAA,UAAU,CAACC,EAAIA,KAACb,EAAS,CAACU,MAAOI,EAAAA,QAAQd,EAAQU,MAAO,IAAK,IAAMK,EAAAA,WAAYZ,GACvF,KAAKa,EAAOA,QACX,GAAIhB,EAAQF,OACX,OAAOmB,UAAQjB,EAAQkB,OAAO,SAAUR,GACvC,OAAQS,EAAKA,MAACT,EAAO,0BAEpB,IAAK,aAAc,IAAK,cACvB,OAAOE,EAAAA,UAAU,CAACC,EAAIA,KAACb,EAAS,CAACkB,MAAO,CAACJ,UAAQJ,EAAO,cAAe,IAAMU,EAAAA,IAAM,UAAWjB,GAE/F,IAAK,gBACJ,OAAOS,YAAU,CAChBC,EAAAA,KAAKb,EAAS,CAACkB,MAAO,CAACJ,EAAAA,QAAQJ,EAAO,aAAc,IAAMK,EAAAA,OAAS,eACnEF,EAAAA,KAAKb,EAAS,CAACkB,MAAO,CAACJ,EAAAA,QAAQJ,EAAO,aAAc,IAAMU,EAAAA,IAAM,SAChEP,EAAAA,KAAKb,EAAS,CAACkB,MAAO,CAACJ,EAAOA,QAACJ,EAAO,aAAcW,EAAEA,GAAG,gBACvDlB,GAGL,MAAO,EACd,IAEA,oBAzCO,SAAoBA,GAC1B,OAAO,SAAUH,GACXA,EAAQsB,OACRtB,EAAUA,EAAQM,SACrBH,EAASH,EACX,CACF"}